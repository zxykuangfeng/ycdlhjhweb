(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55458d7e"],{"64f0":function(t,e,a){},6919:function(t,e,a){"use strict";a("64f0")},cc49:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"collect-page"},[a("h1",[t._v("隐患采集")]),t._v(" "),a("div",{staticClass:"start-box"},[t.isCapturing?t._e():a("button",{on:{click:t.startCollection}},[t._v("开始采集")])]),t._v(" "),t.isCapturing?a("div",{staticClass:"camera-box"},[a("video",{ref:"video",attrs:{width:"100%",height:"auto",autoplay:""}}),t._v(" "),a("canvas",{ref:"canvas",staticStyle:{display:"none"}}),t._v(" "),a("button",{on:{click:t.capturePhoto}},[t._v("拍照")])]):t._e(),t._v(" "),t.capturedImage?a("div",{staticClass:"form-box"},[a("div",{staticClass:"photo-preview"},[a("h3",[t._v("拍摄照片")]),t._v(" "),a("img",{attrs:{src:t.capturedImage,alt:"Captured",width:"100%"}})]),t._v(" "),a("el-form",{attrs:{model:t.formData,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"身份选择"}},[a("el-select",{attrs:{placeholder:"请选择身份"},model:{value:t.formData.identity,callback:function(e){t.$set(t.formData,"identity",e)},expression:"formData.identity"}},[a("el-option",{attrs:{label:"交警大队",value:"交警大队"}}),t._v(" "),a("el-option",{attrs:{label:"交警支队",value:"交警支队"}}),t._v(" "),a("el-option",{attrs:{label:"普通采集",value:"普通采集"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"地址"}},[a("el-input",{attrs:{placeholder:"请输入地址"},model:{value:t.formData.address,callback:function(e){t.$set(t.formData,"address",e)},expression:"formData.address"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"分类选择"}},[a("el-select",{attrs:{placeholder:"请选择分类"},model:{value:t.formData.category,callback:function(e){t.$set(t.formData,"category",e)},expression:"formData.category"}},[a("el-option",{attrs:{label:"隐患",value:"0"}}),t._v(" "),a("el-option",{attrs:{label:"设施",value:"1"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:t.formData.remark,callback:function(e){t.$set(t.formData,"remark",e)},expression:"formData.remark"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.submitData}},[t._v("确认提交")])],1)],1)],1):t._e()])},o=[],i=(a("96cf"),a("1da1")),s={name:"CollectPage",data:function(){return{isCapturing:!1,capturedImage:null,latitude:null,longitude:null,formData:{identity:"",address:"",category:"",remark:""}}},methods:{startCollection:function(){this.isCapturing=!0,this.startCamera()},startCamera:function(){var t=this,e={video:{facingMode:"environment"}};navigator.mediaDevices.getUserMedia(e).then((function(e){t.$refs.video.srcObject=e})).catch((function(t){console.error("Error accessing the camera: ",t)}))},capturePhoto:function(){var t=this.$refs.video,e=this.$refs.canvas,a=e.getContext("2d");e.width=t.videoWidth,e.height=t.videoHeight,a.drawImage(t,0,0,e.width,e.height),this.capturedImage=e.toDataURL("image/png")},getLocation:function(){var t=this;return new Promise((function(e,a){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(a){t.latitude=a.coords.latitude,t.longitude=a.coords.longitude,e({latitude:t.latitude,longitude:t.longitude})}),(function(t){console.error("Error getting location:",t),a(t)})):(console.error("Geolocation is not supported by this browser."),a("Geolocation not supported"))}))},submitData:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getLocation();case 3:return e=t.sent,a={photo:this.capturedImage,identity:this.formData.identity,address:this.formData.address,category:this.formData.category,remark:this.formData.remark,latitude:e.latitude,longitude:e.longitude},console.log("提交数据:",a),t.next=8,fetch("/api/hazard-collection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 8:return r=t.sent,t.next=11,r.json();case 11:o=t.sent,o.success?(this.$message.success("数据提交成功"),this.resetForm()):this.$message.error("数据提交失败，请重试"),t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](0),console.error("提交失败:",t.t0),this.$message.error("获取位置或提交失败，请检查网络");case 19:case"end":return t.stop()}}),t,this,[[0,15]])})));function e(){return t.apply(this,arguments)}return e}(),resetForm:function(){this.isCapturing=!1,this.capturedImage=null,this.formData={identity:"",address:"",category:"",remark:""}}}},n=s,l=(a("6919"),a("2877")),c=Object(l["a"])(n,r,o,!1,null,"29baa9b5",null);e["default"]=c.exports}}]);