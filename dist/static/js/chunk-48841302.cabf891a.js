(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-48841302"],{"219d":function(t,i,e){"use strict";e("724b")},"724b":function(t,i,e){},"9b55":function(t,i,e){"use strict";e.r(i);var l=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"app-container"},[e("div",{staticClass:"filter-container"},[e("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"请输入项目名称",clearable:""},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.handleFilter(i)}},model:{value:t.listQuery.name,callback:function(i){t.$set(t.listQuery,"name",i)},expression:"listQuery.name"}}),t._v(" "),e("el-select",{staticClass:"filter-item",attrs:{placeholder:"请选择施工企业",clearable:""},model:{value:t.listQuery.company_id,callback:function(i){t.$set(t.listQuery,"company_id",i)},expression:"listQuery.company_id"}},t._l(t.userList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.remark,value:t.id}})})),1),t._v(" "),e("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("搜索")])],1),t._v(" "),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,border:"",fit:"","highlight-current-row":""}},[e("el-table-column",{attrs:{label:"项目名称",prop:"name","min-width":"150px",align:"center","show-overflow-tooltip":""}}),t._v(" "),e("el-table-column",{attrs:{label:"施工企业",prop:"qyname","min-width":"150px",align:"center"}}),t._v(" "),e("el-table-column",{attrs:{label:"状态",prop:"status_name","min-width":"100px",align:"center"}}),t._v(" "),e("el-table-column",{attrs:{label:"操作",align:"center",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(i){var l=i.row;return["待申请"===l.status_name?e("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(i){return t.openApplicationDialog(l)}}},[t._v("\n          提交申请\n        ")]):t._e()]}}])})],1),t._v(" "),e("el-dialog",{attrs:{title:"提交施工申请",visible:t.applicationDialogVisible,width:"600px"},on:{"update:visible":function(i){t.applicationDialogVisible=i}}},[e("el-form",{ref:"applicationForm",attrs:{rules:t.rules,model:t.applicationForm,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"申请材料"}},[e("el-upload",{ref:"upload",attrs:{action:"/admin/fileUpload","file-list":t.fileList,"on-success":t.handleUploadSuccess,"on-remove":t.handleFileRemove,multiple:""}},[e("el-button",{attrs:{size:"small",type:"primary"}},[t._v("上传文件")])],1)],1),t._v(" "),e("el-form-item",{attrs:{label:"施工前设施"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.addFacility}},[t._v("添加设施")]),t._v(" "),t._l(t.applicationForm.facilities,(function(i,l){return e("div",{key:l,staticClass:"facility-item"},[e("el-select",{staticClass:"facility-select",attrs:{placeholder:"设施类型"},model:{value:i.type,callback:function(e){t.$set(i,"type",e)},expression:"facility.type"}},[e("el-option",{attrs:{label:"围挡",value:"围挡"}}),t._v(" "),e("el-option",{attrs:{label:"警示牌",value:"警示牌"}}),t._v(" "),e("el-option",{attrs:{label:"指示灯",value:"指示灯"}})],1),t._v(" "),e("el-upload",{attrs:{action:"/admin/fileUpload","on-success":function(i){return t.handleFacilityUpload(i,l)},"file-list":i.fileList}},[e("el-button",{attrs:{size:"small",type:"primary"}},[t._v("上传图片")])],1),t._v(" "),e("el-input",{staticClass:"facility-input",attrs:{placeholder:"设施描述"},model:{value:i.description,callback:function(e){t.$set(i,"description",e)},expression:"facility.description"}}),t._v(" "),e("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(i){return t.removeFacility(l)}}})],1)}))],2)],1),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(i){t.applicationDialogVisible=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.submitApplication}},[t._v("申请")])],1)],1)],1)},a=[],n=(e("7f7f"),e("012d")),o={data:function(){return{list:[],listQuery:{name:"",company_id:null},userList:[],applicationDialogVisible:!1,applicationForm:{materials:[],facilities:[]},fileList:[],rules:{},facilityTypeList:{}}},created:function(){this.getList(),this.facilityType()},methods:{getList:function(){var t=this;Object(n["nb"])(this.listQuery).then((function(i){0===i.code&&(t.list=i.data.data)}))},facilityType:function(){Object(n["w"])().then((function(t){}))},handleFilter:function(){this.getList()},openApplicationDialog:function(t){this.applicationForm={id:t.id,materials:[],facilities:[]},this.fileList=[],this.applicationDialogVisible=!0},handleUploadSuccess:function(t,i){this.applicationForm.materials.push({name:i.name,url:t.url})},handleFileRemove:function(t){this.applicationForm.materials=this.applicationForm.materials.filter((function(i){return i.name!==t.name}))},addFacility:function(){this.applicationForm.facilities.push({type:"",fileList:[],description:""})},removeFacility:function(t){this.applicationForm.facilities.splice(t,1)},handleFacilityUpload:function(t,i){this.applicationForm.facilities[i].fileList.push(t.url)},submitApplication:function(){var t=this;this.$confirm("提交后不可修改，是否确认提交？","提示",{type:"warning"}).then((function(){Object(n["submitConstructionApplication"])(t.applicationForm).then((function(){t.applicationDialogVisible=!1,t.getList()}))}))}}},s=o,c=(e("219d"),e("2877")),r=Object(c["a"])(s,l,a,!1,null,"768530be",null);i["default"]=r.exports}}]);