(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-89c5d704"],{"333d":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"pagination-container",class:{hidden:t.hidden}},[i("el-pagination",t._b({attrs:{background:t.background,"current-page":t.currentPage,"page-size":t.pageSize,layout:t.layout,"page-sizes":t.pageSizes,total:t.total},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}},"el-pagination",t.$attrs,!1))],1)},n=[];i("c5f6");Math.easeInOutQuad=function(t,e,i,a){return t/=a/2,t<1?i/2*t*t+e:(t--,-i/2*(t*(t-2)-1)+e)};var o=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();function s(t){document.documentElement.scrollTop=t,document.body.parentNode.scrollTop=t,document.body.scrollTop=t}function l(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function r(t,e,i){var a=l(),n=t-a,r=20,p=0;e="undefined"===typeof e?500:e;var c=function t(){p+=r;var l=Math.easeInOutQuad(p,a,n,e);s(l),p<e?o(t):i&&"function"===typeof i&&i()};c()}var p={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(t){this.$emit("update:page",t)}},pageSize:{get:function(){return this.limit},set:function(t){this.$emit("update:limit",t)}}},methods:{handleSizeChange:function(t){this.$emit("pagination",{page:this.currentPage,limit:t}),this.autoScroll&&r(0,800)},handleCurrentChange:function(t){this.$emit("pagination",{page:t,limit:this.pageSize}),this.autoScroll&&r(0,800)}}},c=p,u=(i("e498"),i("2877")),m=Object(u["a"])(c,a,n,!1,null,"6af373ef",null);e["a"]=m.exports},7456:function(t,e,i){},"9d08":function(t,e,i){"use strict";i.r(e);var a,n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"请输入项目名称",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.listQuery.name,callback:function(e){t.$set(t.listQuery,"name",e)},expression:"listQuery.name"}}),t._v(" "),i("el-select",{staticClass:"filter-item",attrs:{placeholder:"请选择施工企业",clearable:""},model:{value:t.listQuery.company_id,callback:function(e){t.$set(t.listQuery,"company_id",e)},expression:"listQuery.company_id"}},t._l(t.userList,(function(t){return i("el-option",{key:t.id,attrs:{label:t.remark,value:t.id}})})),1),t._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("搜索")]),t._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.handleCreate}},[t._v("项目录入")])],1),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{label:"项目名称",prop:"name","min-width":"150px",align:"center","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{label:"项目位置",prop:"location","min-width":"150px",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"封闭路段起点",prop:"start_point","min-width":"150px",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"封闭路段终点",prop:"end_point","min-width":"150px",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"施工企业",prop:"company_name","min-width":"150px",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"审批材料",prop:"approval_files","min-width":"150px",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"状态",prop:"status","min-width":"100px",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"操作",align:"center",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("el-button",{attrs:{size:"mini",type:"primary",disabled:"审核中"===a.status},on:{click:function(e){return t.handleUpdate(a)}}},[t._v("编辑")])]}}])})],1),t._v(" "),i("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.limit},on:{"update:page":function(e){return t.$set(t.listQuery,"page",e)},"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},pagination:t.getList}}),t._v(" "),i("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"600px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.temp,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[i("el-input",{model:{value:t.temp.name,callback:function(e){t.$set(t.temp,"name",e)},expression:"temp.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"项目位置",prop:"location"}},[i("el-input",{model:{value:t.temp.location,callback:function(e){t.$set(t.temp,"location",e)},expression:"temp.location"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"封闭路段"}},[i("el-button",{attrs:{type:"primary"},on:{click:t.openMapDialog}},[t._v("选择起点和终点")])],1),t._v(" "),i("el-form-item",{attrs:{label:"起点经纬度",prop:"start_point"}},[i("el-input",{attrs:{readonly:""},model:{value:t.temp.spoint,callback:function(e){t.$set(t.temp,"spoint",e)},expression:"temp.spoint"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"终点经纬度",prop:"end_point"}},[i("el-input",{attrs:{readonly:""},model:{value:t.temp.epoint,callback:function(e){t.$set(t.temp,"epoint",e)},expression:"temp.epoint"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"项目描述",prop:"end_point"}},[i("el-input",{attrs:{type:"textarea"},model:{value:t.temp.desc,callback:function(e){t.$set(t.temp,"desc",e)},expression:"temp.desc"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"施工企业",prop:"company_id"}},[i("el-select",{attrs:{placeholder:"请选择施工企业"},model:{value:t.temp.qyid,callback:function(e){t.$set(t.temp,"qyid",e)},expression:"temp.qyid"}},t._l(t.userList,(function(t){return i("el-option",{key:t.id,attrs:{label:t.remark,value:String(t.id)}})})),1)],1),t._v(" "),i("el-form-item",{attrs:{label:"审批材料"}},[i("el-upload",{ref:"upload",attrs:{action:"/admin/fileUpload","file-list":t.fileList,"on-success":t.handleUploadSuccess,"on-remove":t.handleFileRemove,multiple:""}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("上传文件")])],1)],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.handleCancel}},[t._v("取消")]),t._v("\n        "+t._s(t.temp.epoint)+t._s(t.temp.spoint)+"\n        "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){"create"===t.dialogStatus?t.createData():t.updateData()}}},[t._v("确认")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"选择起点和终点",visible:t.mapDialogVisible,width:"80%"},on:{"update:visible":function(e){t.mapDialogVisible=e},opened:t.initMap}},[i("div",{staticStyle:{"text-align":"center","margin-bottom":"10px"}},[i("el-button",{attrs:{type:"primary",disabled:"start"===t.mapMode},on:{click:function(e){return t.setMapMode("start")}}},[t._v("设置起点")]),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:"end"===t.mapMode},on:{click:function(e){return t.setMapMode("end")}}},[t._v("设置终点")]),t._v(" "),i("el-button",{attrs:{type:"warning"},on:{click:t.resetMap}},[t._v("重置")])],1),t._v(" "),i("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"baiduMap"}}),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.mapDialogVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.confirmMapPoints}},[t._v("确认")])],1)])],1)},o=[],s=i("ade3"),l=(i("7f7f"),i("386d"),i("c5f6"),i("28a5"),i("3835")),r=i("012d"),p=i("333d"),c={components:{Pagination:p["a"]},data:function(){return{list:[],total:0,listQuery:{page:1,limit:20,name:"",company_id:null},userList:[],temp:{name:"",location:"",start_point:"",end_point:"",company_id:"",desc:"",imgs:[],approval_files:"",spoint:"",epoint:"",waypoints:[]},dialogFormVisible:!1,dialogStatus:"",textMap:{create:"新增项目",update:"编辑项目"},rules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},mapDialogVisible:!1,fileList:[],mapMode:""}},created:function(){this.fetchCompanies(),this.getList()},methods:(a={fetchCompanies:function(){var t=this;Object(r["xb"])({}).then((function(e){0===e.code&&(t.userList=e.data)}))},initMap:function(){var t=this;this.map||(this.map=new BMap.Map("baiduMap"),this.map.centerAndZoom(new BMap.Point(120.15,33.38),16),this.map.enableScrollWheelZoom(!0),this.map.addEventListener("click",(function(e){"start"===t.mapMode?t.setStartPoint(e.point):"end"===t.mapMode&&t.setEndPoint(e.point)})))},setStartPoint:function(t){var e=t.lng.toFixed(12),i=t.lat.toFixed(12);this.temp.spoint="".concat(e,",").concat(i),console.log("this"+this.temp.spoint),this.startMarker&&this.map.removeOverlay(this.startMarker),this.startMarker=new BMap.Marker(t);var a=new BMap.Label("起点",{offset:new BMap.Size(20,-10)});this.startMarker.setLabel(a),this.map.addOverlay(this.startMarker),this.$notify({title:"起点设置",message:"已设置起点: ".concat(e,", ").concat(i),type:"success"}),this.temp.spoint&&this.temp.epoint&&this.drawRoute()},setEndPoint:function(t){var e=t.lng.toFixed(12),i=t.lat.toFixed(12);this.temp.epoint="".concat(e,",").concat(i),this.endMarker&&this.map.removeOverlay(this.endMarker),this.endMarker=new BMap.Marker(t);var a=new BMap.Label("终点",{offset:new BMap.Size(20,-10)});this.endMarker.setLabel(a),this.map.addOverlay(this.endMarker),this.$notify({title:"终点设置",message:"已设置终点: ".concat(e,", ").concat(i),type:"success"}),this.temp.spoint&&this.temp.epoint&&this.drawRoute()},setMapMode:function(t){this.mapMode=t,this.$notify({title:"模式切换",message:"当前模式: 设置".concat("start"===t?"起点":"终点"),type:"info"})},resetMap:function(){this.temp.spoint="",this.temp.epoint="",this.temp.waypoints=[],this.temp.length="",this.startMarker&&(this.map.removeOverlay(this.startMarker),this.startMarker=null),this.endMarker&&(this.map.removeOverlay(this.endMarker),this.endMarker=null),this.highlightedRoute&&(this.map.removeOverlay(this.highlightedRoute),this.highlightedRoute=null),this.route&&(this.route.clearResults(),this.route=null),this.$notify({title:"地图重置",message:"已清空所有选择",type:"warning"})},confirmMapPoints:function(){this.temp.spoint&&this.temp.epoint?this.mapDialogVisible=!1:this.$notify({title:"Error",message:"请先选择起点和终点",type:"error"})},addMarker:function(t,e){var i=new BMap.Marker(t),a=new BMap.Label(e,{offset:new BMap.Size(20,-10)});i.setLabel(a),this.map.addOverlay(i),"起点"===e?this.startMarker=i:this.endMarker=i},drawRoute:function(){var t=this;if(this.temp.spoint&&this.temp.epoint){var e=this.temp.spoint.split(",").map(Number),i=Object(l["a"])(e,2),a=i[0],n=i[1],o=this.temp.epoint.split(",").map(Number),s=Object(l["a"])(o,2),r=s[0],p=s[1],c=new BMap.Point(a,n),u=new BMap.Point(r,p),m=new BMap.DrivingRoute(this.map,{renderOptions:{map:this.map,autoViewport:!0,drivingPolicy:"BMAP_DRIVING_POLICY_LEAST_DISTANCE"},onSearchComplete:function(e){if(m.getStatus()===BMAP_STATUS_SUCCESS){var i=e.getPlan(0),a=i.getRoute(0),n=a.getPath();n=t.simplifyPath(n,1e-4),t.updateMapPath(n),t.temp.length=(i.getDistance(!1)/1e3).toFixed(2),t.temp.waypoints=n.map((function(t){return{lng:t.lng.toFixed(12),lat:t.lat.toFixed(12)}}))}}});m.search(c,u)}},simplifyPath:function(t,e){var i=e*e;function a(t,e){var i=t.lng-e.lng,a=t.lat-e.lat;return i*i+a*a}function n(t,e){for(var i=t[0],n=[i],o=1;o<t.length;o++)a(t[o],i)>e&&n.push(t[o]);return n[n.length-1]!==t[t.length-1]&&n.push(t[t.length-1]),n}return n(t,i)},updateMapPath:function(t){this.highlightedRoute&&this.map.removeOverlay(this.highlightedRoute),this.highlightedRoute=new BMap.Polyline(t,{strokeColor:"blue",strokeWeight:5,strokeOpacity:.8}),this.map.addOverlay(this.highlightedRoute)}},Object(s["a"])(a,"resetMap",(function(){this.temp.spoint="",this.temp.epoint="",this.temp.waypoints=[],this.temp.length="",this.startMarker&&(this.map.removeOverlay(this.startMarker),this.startMarker=null),this.endMarker&&(this.map.removeOverlay(this.endMarker),this.endMarker=null),this.highlightedRoute&&(this.map.removeOverlay(this.highlightedRoute),this.highlightedRoute=null),this.route&&(this.route.clearResults(),this.route=null),this.map.clearOverlays(),this.$notify({title:"地图重置",message:"已清空所有选择",type:"warning"})})),Object(s["a"])(a,"getList",(function(){var t=this;Object(r["nb"])(this.listQuery).then((function(e){0===e.code&&(t.list=e.data.data.map((function(t){return{id:t.id,name:t.name,location:t.desc,start_point:t.spoint,end_point:t.epoint,company_name:t.qyname,approval_files:t.imgs?t.imgs.join(", "):"无",imgs:t.imgs?t.imgs.join(", "):"无",status:t.status_name,qyid:t.qyid}})),t.total=e.data.total)}))})),Object(s["a"])(a,"formatStatus",(function(t){return t.status})),Object(s["a"])(a,"handleFilter",(function(){this.getList()})),Object(s["a"])(a,"handleCreate",(function(){this.temp={name:"",location:"",start_point:"",end_point:"",company_id:"",approval_files:""},this.dialogStatus="create",this.dialogFormVisible=!0})),Object(s["a"])(a,"handleUpdate",(function(t){console.log("row11111111"),console.log(t),this.temp={id:t.id||null,name:t.name||"",location:t.location||"",start_point:t.start_point||"",end_point:t.end_point||"",spoint:t.start_point||"",epoint:t.end_point||"",desc:t.location||"",qyid:t.qyid?String(t.qyid):"",approval_files:t.imgs||"",imgs:t.imgs?t.imgs.split(",").map((function(t){return t.trim()})):[],waypoints:t.waypoints||[]},this.dialogStatus="update",this.dialogFormVisible=!0})),Object(s["a"])(a,"createData",(function(){var t=this;this.fileList=[],Object(r["kb"])(this.temp).then((function(e){0===e.code?(t.$message.success("添加成功"),t.dialogFormVisible=!1,t.getList()):t.$message.error(e.msg)}))})),Object(s["a"])(a,"updateData",(function(){var t=this;this.fileList=[],Object(r["mb"])(this.temp).then((function(e){0===e.code?(t.$message.success("修改成功"),t.dialogFormVisible=!1,t.getList()):t.$message.error(e.msg)}))})),Object(s["a"])(a,"openMapDialog",(function(){this.mapDialogVisible=!0})),Object(s["a"])(a,"sgxmApply",(function(t){var e=this;this.$confirm("确认提交审核？","提示",{type:"warning"}).then((function(){Object(r["lb"])(t.id).then((function(){return e.getList()}))}))})),Object(s["a"])(a,"handleUploadSuccess",(function(t,e){this.fileList.push({name:e.name,url:t.data.url}),Array.isArray(this.temp.imgs)||(this.temp.imgs=[]),this.temp.imgs.push(t.data.url)})),Object(s["a"])(a,"handleFileRemove",(function(t){this.fileList=this.fileList.filter((function(e){return e.name!==t.name})),Array.isArray(this.temp.imgs)&&(this.temp.imgs=this.temp.imgs.filter((function(e){return e!==t.url})))})),Object(s["a"])(a,"handleCancel",(function(){this.dialogFormVisible=!1,this.fileList=[],this.$refs.upload&&this.$refs.upload.clearFiles()})),a)},u=c,m=i("2877"),d=Object(m["a"])(u,n,o,!1,null,null,null);e["default"]=d.exports},e498:function(t,e,i){"use strict";i("7456")}}]);