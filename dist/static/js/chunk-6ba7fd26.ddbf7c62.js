(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6ba7fd26"],{"2bfa":function(e,t,r){},8905:function(e,t,r){"use strict";r("2bfa")},feac:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-button",{attrs:{type:"primary"},on:{click:e.handleAddRole}},[e._v("新增角色")]),e._v(" "),r("el-table",{staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.list,border:""}},[r("el-table-column",{attrs:{label:"ID",prop:"id",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.id))])]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"角色名",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.role_name))]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"角色描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.role_describe))]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"创建日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.created_at))]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"更新日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.updated_at))]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[1!=t.row.id?r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){return e.handleEdit(t)}}},[e._v("编辑")]):e._e(),e._v(" "),1!=t.row.id?r("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),r("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"编辑角色":"新增角色"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{attrs:{model:e.role,"label-width":"80px","label-position":"left",rules:e.rules}},[r("el-form-item",{attrs:{label:"角色名称",prop:"role_name"}},[r("el-input",{attrs:{placeholder:"请填写角色名称"},model:{value:e.role.role_name,callback:function(t){e.$set(e.role,"role_name",t)},expression:"role.role_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色描述",prop:"role_describe"}},[r("el-input",{attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请填写角色描述"},model:{value:e.role.role_describe,callback:function(t){e.$set(e.role,"role_describe",t)},expression:"role.role_describe"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色权限",prop:"role_describe"}},[r("el-tree",{ref:"tree",staticClass:"permission-tree",attrs:{"check-strictly":e.checkStrictly,data:e.routesData,props:e.defaultProps,"show-checkbox":"","node-key":"name"}})],1)],1),e._v(" "),r("div",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{loading:e.downloadLoading,type:"primary"},on:{click:e.confirmRole}},[e._v("确认")])],1)],1)],1)},n=[],l=r("2909"),o=r("b85c"),a=(r("6762"),r("2fdb"),r("7f7f"),r("5530")),s=(r("ac6a"),r("df7c")),c=r.n(s),d=r("025e"),u=r("c24f"),h=r("a18c"),f={key:"",name:"",description:""},g={name:"Role",data:function(){return{count:"",list:[],listQuery:{page:1,limit:20},role:Object.assign({},f),routes:[],rolesList:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},downloadLoading:!1,rules:{role_name:[{required:!0,message:"请输入角色名",trigger:"blur"}],role_describe:[{required:!0,message:"请输入角色描述",trigger:"blur"}],checkStrictly:[{required:!0,message:"请选择角色权限",trigger:"blur"}]}}},computed:{routesData:function(){return this.routes}},created:function(){this.getRoutes(),this.getList()},methods:{filterServeAsyncRoutes:function(e,t){var r=this,i=[];return e.forEach((function(e){var n=Object(a["a"])({},e);r.hasServePermission(t,n)&&(n.children&&(n.children=r.filterServeAsyncRoutes(n.children,t)),i.push(n))})),i},hasServePermission:function(e,t){return!!t.hidden||(!t.name||e.includes(t.name))},getRoutes:function(){this.routes=this.generateRoutes(h["a"])},getList:function(){var e=this;this.listLoading=!0,console.log(666666666),Object(u["f"])(this.listQuery).then((function(t){e.list=t.data.data,e.count=t.data.count,e.roles=t.data.roles,e.listLoading=!1}))},generateRoutes:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",i=[],n=Object(o["a"])(e);try{for(n.s();!(t=n.n()).done;){var l=t.value;if(!l.hidden){var a=this.onlyOneShowingChild(l.children,l);l.children&&a&&!l.alwaysShow&&(l=a);var s={path:c.a.resolve(r,l.path),title:l.meta&&l.meta.title,name:l.name};l.children&&(s.children=this.generateRoutes(l.children,s.path)),i.push(s)}}}catch(d){n.e(d)}finally{n.f()}return i},generateArr:function(e){var t=this,r=[];return e.forEach((function(e){if(r.push(e),e.children){var i=t.generateArr(e.children);i.length>0&&(r=[].concat(Object(l["a"])(r),Object(l["a"])(i)))}})),r},handleAddRole:function(){this.role={},this.$refs.tree&&this.$refs.tree.setCheckedNodes([]),this.dialogType="new",this.dialogVisible=!0},handleEdit:function(e){var t=this;this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.role=Object(d["c"])(e.row),console.log(222222222222),console.log(this.role);var r=this.role.role_auth,i=this.filterServeAsyncRoutes(this.routes,r);this.$nextTick((function(){var e=t.generateRoutes(i);t.$refs.tree.setCheckedNodes(t.generateArr(e)),t.checkStrictly=!1}))},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var r={};r.role_id=e.id,Object(u["c"])(r).then((function(e){"S"==e.status?t.$notify({title:"Success",message:"删除成功",type:"success",duration:1e3}):t.$notify({title:"Error",message:e.message,type:"warning",duration:1e3}),t.getList()}))})).catch((function(){t.$notify({title:"Info",message:"已取消删除",type:"info",duration:1e3})}))},generateTree:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",i=arguments.length>2?arguments[2]:void 0,n=[],l=Object(o["a"])(e);try{for(l.s();!(t=l.n()).done;){var a=t.value,s=c.a.resolve(r,a.path);a.children&&(a.children=this.generateTree(a.children,s,i)),(i.includes(s)||a.children&&a.children.length>=1)&&n.push(a)}}catch(d){l.e(d)}finally{l.f()}return n},confirmRole:function(){var e=this;this.downloadLoading=!0;var t="edit"===this.dialogType,r=this.$refs.tree.getHalfCheckedKeys().concat(this.$refs.tree.getCheckedKeys());if(t){this.role.role_auth=r;var i={};i.role_id=this.role.id,i.role_name=this.role.role_name,i.role_describe=this.role.role_describe,i.role_auth=this.role.role_auth,Object(u["j"])(i).then((function(t){"S"==t.status?e.$notify({title:"Success",message:"编辑成功",type:"success",duration:1e3}):e.$notify({title:"Error",message:t.message,type:"warning",duration:1e3}),e.downloadLoading=!1,e.getList(),e.role={},e.dialogVisible=!1}))}else this.role.role_auth=r,Object(u["a"])(this.role).then((function(t){"S"==t.status?e.$notify({title:"Success",message:"添加成功",type:"success",duration:1e3}):e.$notify({title:"Error",message:t.message,type:"warning",duration:1e3}),e.downloadLoading=!1,e.getList(),e.role={},e.dialogVisible=!1}))},onlyOneShowingChild:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=null,i=e.filter((function(e){return!e.hidden}));return 1===i.length?(r=i[0],r.path=c.a.resolve(t.path,r.path),r):0===i.length&&(r=Object(a["a"])(Object(a["a"])({},t),{},{path:"",noShowingChildren:!0}),r)}}},p=g,b=(r("8905"),r("2877")),m=Object(b["a"])(p,i,n,!1,null,"bc915372",null);t["default"]=m.exports}}]);