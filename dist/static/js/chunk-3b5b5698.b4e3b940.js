(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b5b5698"],{4497:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.openDialog}},[t._v("添加巡检规划")])],1),t._v(" "),s("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:t.inspectionPlans,border:""}},[s("el-table-column",{attrs:{prop:"inspection_date",label:"巡检日期",width:"150"}}),t._v(" "),s("el-table-column",{attrs:{prop:"section_name",label:"路段"}}),t._v(" "),s("el-table-column",{attrs:{prop:"crossing_name",label:"路口"}}),t._v(" "),s("el-table-column",{attrs:{prop:"status",label:"状态",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[s("el-tag",{attrs:{type:0===n.status?"info":"success"}},[t._v("\n          "+t._s(0===n.status?"待巡检":"已完成")+"\n        ")])]}}])})],1),t._v(" "),s("el-dialog",{attrs:{title:"添加巡检规划",visible:t.dialogVisible,width:"500px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("el-form",{attrs:{"label-width":"80px"}},[s("el-form-item",{attrs:{label:"巡检日期"}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择巡检日期"},model:{value:t.inspectionDate,callback:function(e){t.inspectionDate=e},expression:"inspectionDate"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"路段"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择路段"},model:{value:t.selectedRoads,callback:function(e){t.selectedRoads=e},expression:"selectedRoads"}},t._l(t.roadList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),t._v(" "),s("el-form-item",{attrs:{label:"路口"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择路口"},model:{value:t.selectedCrossings,callback:function(e){t.selectedCrossings=e},expression:"selectedCrossings"}},t._l(t.crossingList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1)],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确定")])],1)],1)],1)},i=[],a=(s("7f7f"),s("7514"),s("96cf"),s("1da1")),o=s("012d"),c={name:"InspectionPlan",data:function(){return{dialogVisible:!1,inspectionDate:"",roadList:[],crossingList:[],selectedRoads:[],selectedCrossings:[],inspectionPlans:[]}},created:function(){this.fetchRoadsAndCrossings(),this.fetchInspectionPlans()},methods:{fetchRoadsAndCrossings:function(){var t=this;Object(o["I"])().then((function(e){0===e.code&&(t.roadList=e.data.data)})),Object(o["D"])().then((function(e){0===e.code&&(t.crossingList=e.data.data)}))},fetchInspectionPlans:function(){var t=this;Object(o["P"])().then((function(e){0===e.code&&(t.inspectionPlans=e.data)}))},viewInspectionPlanDetail:function(t){var e=this;Object(o["O"])(t).then((function(t){if(0===t.code){var s=t.data;console.log("巡检规划详情:",s)}else e.$message.error("获取巡检规划详情失败")}))},changeInspectionPlanStatus:function(t,e){var s=this;Object(o["N"])(t,{status:e}).then((function(t){0===t.code?(s.$message.success("巡检规划状态更新成功"),s.fetchInspectionPlans()):s.$message.error("修改巡检规划状态失败")}))},openDialog:function(){this.dialogVisible=!0},handleSubmit:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,s,n,i,a,c=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.inspectionDate&&0!==this.selectedRoads.length){t.next=3;break}return this.$message.warning("请选择巡检日期并至少选择一个路段！"),t.abrupt("return");case 3:return e=new Date(this.inspectionDate).toLocaleDateString("en-CA"),s=this.selectedRoads.map((function(t){var e=c.roadList.find((function(e){return e.id===t}));return e?e.name:"未知路段"})).join(", "),n=this.selectedCrossings.map((function(t){var e=c.crossingList.find((function(e){return e.id===t}));return e?e.name:"未知路口"})).join(", "),i={inspection_date:e,section:this.selectedRoads,crossing:this.selectedCrossings},t.prev=7,t.next=10,Object(o["b"])(i);case 10:a=t.sent,0===a.code?(this.$message.success("巡检规划添加成功！"),this.inspectionPlans.push({date:e,roadNames:s,crossingNames:n,status:0}),this.dialogVisible=!1,this.inspectionDate="",this.selectedRoads=[],this.selectedCrossings=[]):this.$message.error(a.msg||"添加失败"),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](7),console.error("提交巡检规划失败:",t.t0),this.$message.error("请求失败，请检查网络或联系管理员");case 18:case"end":return t.stop()}}),t,this,[[7,14]])})));function e(){return t.apply(this,arguments)}return e}()}},l=c,r=(s("4751"),s("2877")),d=Object(r["a"])(l,n,i,!1,null,"52b1a071",null);e["default"]=d.exports},4751:function(t,e,s){"use strict";s("d90c")},d90c:function(t,e,s){}}]);